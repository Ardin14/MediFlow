# Local Development Guide

## Prerequisites

1. **Node.js and npm**
   - Node.js v18 or later
   - npm v9 or later

2. **PostgreSQL**
   - Version 14 or later
   - PostGIS extension

3. **Supabase CLI**
   ```bash
   npm install -g supabase-cli
   ```

4. **Development Tools**
   - Visual Studio Code
   - Recommended extensions:
     - ESLint
     - Prettier
     - TypeScript and JavaScript
     - Tailwind CSS IntelliSense
     - PostgreSQL

## Initial Setup

1. **Clone the Repository**
   ```bash
   git clone https://github.com/Ardin14/MediFlow.git
   cd MediFlow
   ```

2. **Install Dependencies**
   ```bash
   npm install
   ```

3. **Set Up Environment Variables**
   ```bash
   cp .env.example .env.local
   ```
   Edit `.env.local` with your local configuration:
   ```env
   VITE_SUPABASE_URL=your_supabase_url
   VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
   VITE_APP_URL=http://localhost:3000
   ```

4. **Initialize Supabase Project**
   ```bash
   supabase init
   supabase start
   ```

5. **Run Database Migrations**
   ```bash
   supabase db reset
   ```

## Development Workflow

1. **Start Development Server**
   ```bash
   npm run dev
   ```
   This will start:
   - Vite dev server on port 3000
   - Supabase local instance
   - TypeScript type checking in watch mode

2. **Create New Feature Branch**
   ```bash
   git checkout -b feature/your-feature-name
   ```

3. **Running Tests**
   ```bash
   # Unit tests
   npm run test
   
   # E2E tests
   npm run test:e2e
   
   # Type checking
   npm run typecheck
   ```

4. **Code Formatting**
   ```bash
   # Format all files
   npm run format
   
   # Check formatting
   npm run format:check
   ```

## Project Structure

```
mediflow/
├── src/
│   ├── react-app/           # Frontend application
│   │   ├── components/      # Reusable components
│   │   ├── pages/          # Page components
│   │   ├── lib/            # Utilities and helpers
│   │   └── types/          # TypeScript types
│   ├── shared/             # Shared types and utilities
│   └── worker/             # Edge functions
├── supabase/
│   ├── functions/          # Supabase Edge Functions
│   └── migrations/         # Database migrations
├── docs/
│   ├── technical/         # Technical documentation
│   └── user/             # User documentation
└── tests/
    ├── unit/             # Unit tests
    └── e2e/              # End-to-end tests
```

## Component Development

1. **Creating New Components**
   ```tsx
   // src/react-app/components/YourComponent.tsx
   interface Props {
     // Define props
   }

   export default function YourComponent({ prop1, prop2 }: Props) {
     // Component logic
     return (
       // JSX
     );
   }
   ```

2. **Styling Guidelines**
   - Use Tailwind CSS for styling
   - Create custom components for repeated patterns
   - Follow the project's color scheme and spacing

3. **State Management**
   - Use React Query for server state
   - Use React Context for global UI state
   - Keep component state minimal

## Database Development

1. **Creating Migrations**
   ```bash
   supabase migration new your-migration-name
   ```

2. **Writing Migrations**
   ```sql
   -- supabase/migrations/[timestamp]_your-migration-name.sql
   -- Up Migration
   CREATE TABLE your_table (
     id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
     -- other columns
   );

   -- Down Migration
   DROP TABLE your_table;
   ```

3. **Adding RLS Policies**
   ```sql
   -- Enable RLS
   ALTER TABLE your_table ENABLE ROW LEVEL SECURITY;

   -- Create policies
   CREATE POLICY "Users can view their data" ON your_table
     FOR SELECT USING (
       auth.uid() = user_id
     );
   ```

## Testing

1. **Unit Tests**
   ```typescript
   // tests/unit/YourComponent.test.tsx
   import { render, screen } from '@testing-library/react';
   import YourComponent from './YourComponent';

   describe('YourComponent', () => {
     it('renders correctly', () => {
       render(<YourComponent />);
       expect(screen.getByText('Expected Text')).toBeInTheDocument();
     });
   });
   ```

2. **E2E Tests**
   ```typescript
   // tests/e2e/patient-registration.spec.ts
   describe('Patient Registration', () => {
     beforeEach(() => {
       cy.login();
       cy.visit('/patients/new');
     });

     it('successfully registers a new patient', () => {
       cy.get('[data-testid="name-input"]').type('John Doe');
       // More test steps...
     });
   });
   ```

## Deployment

1. **Production Build**
   ```bash
   npm run build
   ```

2. **Deploy Database Changes**
   ```bash
   supabase db push
   ```

3. **Deploy Edge Functions**
   ```bash
   supabase functions deploy
   ```

## Troubleshooting

1. **Database Connection Issues**
   - Check `supabase status`
   - Verify connection string in `.env.local`
   - Check PostgreSQL service status

2. **Build Errors**
   - Clear build cache: `npm run clean`
   - Check TypeScript errors: `npm run typecheck`
   - Verify dependency versions

3. **Runtime Errors**
   - Check browser console
   - Review Supabase logs
   - Check Edge Function logs

## Best Practices

1. **Code Quality**
   - Write meaningful comments
   - Follow TypeScript best practices
   - Use consistent naming conventions

2. **Performance**
   - Optimize database queries
   - Implement proper caching
   - Use code splitting

3. **Security**
   - Always use RLS policies
   - Validate user input
   - Follow security guidelines

## Contributing

1. **Pull Request Process**
   - Create feature branch
   - Write tests
   - Update documentation
   - Submit PR with description

2. **Code Review Guidelines**
   - Check test coverage
   - Verify TypeScript types
   - Review security implications